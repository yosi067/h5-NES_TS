# NES 技術規格參考

## 6502 CPU 指令集速查表

### 載入/儲存指令

| 指令 | 說明 | 影響旗標 |
|------|------|----------|
| LDA | 載入到 A | N, Z |
| LDX | 載入到 X | N, Z |
| LDY | 載入到 Y | N, Z |
| STA | 儲存 A | - |
| STX | 儲存 X | - |
| STY | 儲存 Y | - |

### 傳送指令

| 指令 | 說明 | 影響旗標 |
|------|------|----------|
| TAX | A → X | N, Z |
| TAY | A → Y | N, Z |
| TXA | X → A | N, Z |
| TYA | Y → A | N, Z |
| TSX | SP → X | N, Z |
| TXS | X → SP | - |

### 堆疊指令

| 指令 | 說明 | 影響旗標 |
|------|------|----------|
| PHA | 推送 A | - |
| PHP | 推送狀態 | - |
| PLA | 彈出到 A | N, Z |
| PLP | 彈出到狀態 | 全部 |

### 算術指令

| 指令 | 說明 | 影響旗標 |
|------|------|----------|
| ADC | A + M + C → A | N, V, Z, C |
| SBC | A - M - (1-C) → A | N, V, Z, C |
| INC | M + 1 → M | N, Z |
| INX | X + 1 → X | N, Z |
| INY | Y + 1 → Y | N, Z |
| DEC | M - 1 → M | N, Z |
| DEX | X - 1 → X | N, Z |
| DEY | Y - 1 → Y | N, Z |

### 邏輯指令

| 指令 | 說明 | 影響旗標 |
|------|------|----------|
| AND | A ∧ M → A | N, Z |
| ORA | A ∨ M → A | N, Z |
| EOR | A ⊕ M → A | N, Z |
| BIT | A ∧ M | N, V, Z |

### 移位指令

| 指令 | 說明 | 影響旗標 |
|------|------|----------|
| ASL | 左移 | N, Z, C |
| LSR | 右移 | N, Z, C |
| ROL | 左旋轉 | N, Z, C |
| ROR | 右旋轉 | N, Z, C |

### 比較指令

| 指令 | 說明 | 影響旗標 |
|------|------|----------|
| CMP | A - M | N, Z, C |
| CPX | X - M | N, Z, C |
| CPY | Y - M | N, Z, C |

### 分支指令

| 指令 | 條件 |
|------|------|
| BCC | C = 0 |
| BCS | C = 1 |
| BEQ | Z = 1 |
| BNE | Z = 0 |
| BMI | N = 1 |
| BPL | N = 0 |
| BVC | V = 0 |
| BVS | V = 1 |

### 跳躍和呼叫

| 指令 | 說明 |
|------|------|
| JMP | 跳躍到位址 |
| JSR | 呼叫副程式 |
| RTS | 從副程式返回 |
| RTI | 從中斷返回 |

### 旗標操作

| 指令 | 說明 |
|------|------|
| CLC | C = 0 |
| SEC | C = 1 |
| CLD | D = 0 |
| SED | D = 1 |
| CLI | I = 0 |
| SEI | I = 1 |
| CLV | V = 0 |

### 其他

| 指令 | 說明 |
|------|------|
| NOP | 無操作 |
| BRK | 觸發中斷 |

---

## 定址模式

| 模式 | 語法 | 說明 | 範例 |
|------|------|------|------|
| Implicit | - | 隱含 | CLC |
| Accumulator | A | 累加器 | ASL A |
| Immediate | #nn | 立即值 | LDA #$42 |
| Zero Page | nn | 零頁 | LDA $10 |
| Zero Page,X | nn,X | 零頁 X 索引 | LDA $10,X |
| Zero Page,Y | nn,Y | 零頁 Y 索引 | LDX $10,Y |
| Relative | nn | 相對 (分支) | BEQ $10 |
| Absolute | nnnn | 絕對 | LDA $1234 |
| Absolute,X | nnnn,X | 絕對 X 索引 | LDA $1234,X |
| Absolute,Y | nnnn,Y | 絕對 Y 索引 | LDA $1234,Y |
| Indirect | (nnnn) | 間接 | JMP ($1234) |
| (Indirect,X) | (nn,X) | 索引間接 | LDA ($10,X) |
| (Indirect),Y | (nn),Y | 間接索引 | LDA ($10),Y |

---

## PPU 暫存器

| 位址 | 名稱 | 讀/寫 | 說明 |
|------|------|-------|------|
| $2000 | PPUCTRL | W | 控制暫存器 |
| $2001 | PPUMASK | W | 遮罩暫存器 |
| $2002 | PPUSTATUS | R | 狀態暫存器 |
| $2003 | OAMADDR | W | OAM 位址 |
| $2004 | OAMDATA | R/W | OAM 資料 |
| $2005 | PPUSCROLL | W×2 | 捲動位置 |
| $2006 | PPUADDR | W×2 | VRAM 位址 |
| $2007 | PPUDATA | R/W | VRAM 資料 |
| $4014 | OAMDMA | W | OAM DMA |

### PPUCTRL ($2000) 位元定義

```
7654 3210
|||| ||||
|||| ||++- 命名表選擇 (0=$2000, 1=$2400, 2=$2800, 3=$2C00)
|||| |+--- VRAM 增量 (0=+1, 1=+32)
|||| +---- 精靈圖案表 (0=$0000, 1=$1000)
|||+------ 背景圖案表 (0=$0000, 1=$1000)
||+------- 精靈大小 (0=8x8, 1=8x16)
|+-------- 主/從選擇 (未使用)
+--------- VBlank 時產生 NMI
```

### PPUMASK ($2001) 位元定義

```
7654 3210
|||| ||||
|||| |||+- 灰階模式
|||| ||+-- 顯示背景 (左 8 像素)
|||| |+--- 顯示精靈 (左 8 像素)
|||| +---- 顯示背景
|||+------ 顯示精靈
||+------- 加強紅色
|+-------- 加強綠色
+--------- 加強藍色
```

### PPUSTATUS ($2002) 位元定義

```
7654 3210
|||| ||||
|||+-++++- 未使用
||+------- 精靈溢出
|+-------- 精靈 0 碰撞
+--------- VBlank 進行中
```

---

## OAM (精靈) 格式

每個精靈使用 4 個位元組：

| 位元組 | 說明 |
|--------|------|
| 0 | Y 座標 (頂端) |
| 1 | 圖塊編號 |
| 2 | 屬性 |
| 3 | X 座標 (左側) |

### 精靈屬性 (位元組 2)

```
7654 3210
|||| ||||
|||| ||++- 調色盤 (4-7)
|||+-++--- 未使用
||+------- 優先級 (0=前景, 1=背景)
|+-------- 水平翻轉
+--------- 垂直翻轉
```

---

## iNES ROM 格式

### 標頭 (16 位元組)

| 位元組 | 說明 |
|--------|------|
| 0-3 | "NES" + $1A |
| 4 | PRG ROM 大小 (16KB 為單位) |
| 5 | CHR ROM 大小 (8KB 為單位) |
| 6 | Flags 6 |
| 7 | Flags 7 |
| 8-15 | 其他標誌 |

### Flags 6

```
7654 3210
|||| ||||
|||| |||+- 鏡像 (0=水平, 1=垂直)
|||| ||+-- 電池備份
|||| |+--- 有 512 位元組 Trainer
|||| +---- 四螢幕模式
++++------ Mapper 編號低 4 位元
```

### Flags 7

```
7654 3210
|||| ||||
|||| ||++- VS/Playchoice
|||| ++--- NES 2.0 識別
++++------ Mapper 編號高 4 位元
```

---

## 常用 Mapper

| 編號 | 名稱 | PRG | CHR | 遊戲範例 |
|------|------|-----|-----|----------|
| 0 | NROM | 32KB | 8KB | 超級瑪利歐兄弟, 大金剛 |
| 1 | MMC1 | 256KB | 128KB | 薩爾達傳說, 洛乞曼2 |
| 2 | UxROM | 256KB | CHR RAM | 洛乞曼, 惡魔城 |
| 3 | CNROM | 32KB | 32KB | 所羅門之鍵 |
| 4 | MMC3 | 512KB | 256KB | 超級瑪利歐3, 洛乞曼3-6 |

---

*參考資料: nesdev.org wiki*
