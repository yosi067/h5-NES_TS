(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();class K{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,H.unregister(this),t}free(){const t=this.__destroy_into_raw();u.__wbg_neswasm_free(t,0)}consumeAudioSamples(){return u.neswasm_consumeAudioSamples(this.__wbg_ptr)>>>0}exportSaveState(){let t,n;try{const a=u.__wbindgen_add_to_stack_pointer(-16);u.neswasm_exportSaveState(a,this.__wbg_ptr);var s=Z().getInt32(a+4*0,!0),r=Z().getInt32(a+4*1,!0);return t=s,n=r,J(s,r)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_export(t,n,1)}}frame(){u.neswasm_frame(this.__wbg_ptr)}getAudioBufferLen(){return u.neswasm_getAudioBufferLen(this.__wbg_ptr)>>>0}getAudioBufferPtr(){return u.neswasm_getAudioBufferPtr(this.__wbg_ptr)>>>0}getFrameBufferLen(){return u.neswasm_getFrameBufferLen(this.__wbg_ptr)>>>0}getFrameBufferPtr(){return u.neswasm_getFrameBufferPtr(this.__wbg_ptr)>>>0}getWasmMemory(){const t=u.neswasm_getWasmMemory(this.__wbg_ptr);return ce(t)}importSaveState(t){const n=ie(t,u.__wbindgen_export2,u.__wbindgen_export3),s=F;return u.neswasm_importSaveState(this.__wbg_ptr,n,s)!==0}loadRom(t){const n=ae(t,u.__wbindgen_export2),s=F;return u.neswasm_loadRom(this.__wbg_ptr,n,s)!==0}constructor(){const t=u.neswasm_new();return this.__wbg_ptr=t>>>0,H.register(this,this.__wbg_ptr,this),this}reset(){u.neswasm_reset(this.__wbg_ptr)}setAudioSampleRate(t){u.neswasm_setAudioSampleRate(this.__wbg_ptr,t)}setButton(t,n,s){u.neswasm_setButton(this.__wbg_ptr,t,n,s)}}Symbol.dispose&&(K.prototype[Symbol.dispose]=K.prototype.free);function ne(){return{__proto__:null,"./nes_wasm_bg.js":{__proto__:null,__wbg___wbindgen_memory_bd1fbcf21fbef3c8:function(){const t=u.memory;return se(t)},__wbg___wbindgen_throw_be289d5034ed271b:function(t,n){throw new Error(J(t,n))}}}}const H=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>u.__wbg_neswasm_free(e>>>0,1));function se(e){I===y.length&&y.push(y.length+1);const t=I;return I=y[t],y[t]=e,t}function re(e){e<132||(y[e]=I,I=e)}let v=null;function Z(){return(v===null||v.buffer.detached===!0||v.buffer.detached===void 0&&v.buffer!==u.memory.buffer)&&(v=new DataView(u.memory.buffer)),v}function J(e,t){return e=e>>>0,ue(e,t)}let S=null;function D(){return(S===null||S.byteLength===0)&&(S=new Uint8Array(u.memory.buffer)),S}function oe(e){return y[e]}let y=new Array(128).fill(void 0);y.push(void 0,null,!0,!1);let I=y.length;function ae(e,t){const n=t(e.length*1,1)>>>0;return D().set(e,n/1),F=e.length,n}function ie(e,t,n){if(n===void 0){const d=x.encode(e),f=t(d.length,1)>>>0;return D().subarray(f,f+d.length).set(d),F=d.length,f}let s=e.length,r=t(s,1)>>>0;const a=D();let o=0;for(;o<s;o++){const d=e.charCodeAt(o);if(d>127)break;a[r+o]=d}if(o!==s){o!==0&&(e=e.slice(o)),r=n(r,s,s=o+e.length*3,1)>>>0;const d=D().subarray(r+o,r+s),f=x.encodeInto(e,d);o+=f.written,r=n(r,s,o,1)>>>0}return F=o,r}function ce(e){const t=oe(e);return re(e),t}let W=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});W.decode();const le=2146435072;let q=0;function ue(e,t){return q+=t,q>=le&&(W=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),W.decode(),q=t),W.decode(D().subarray(e,e+t))}const x=new TextEncoder;"encodeInto"in x||(x.encodeInto=function(e,t){const n=x.encode(e);return t.set(n),{read:e.length,written:n.length}});let F=0,u;function de(e,t){return u=e.exports,v=null,S=null,u}async function fe(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(r){if(e.ok&&n(e.type)&&e.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const s=await e.arrayBuffer();return await WebAssembly.instantiate(s,t)}else{const s=await WebAssembly.instantiate(e,t);return s instanceof WebAssembly.Instance?{instance:s,module:e}:s}function n(s){switch(s){case"basic":case"cors":case"default":return!0}return!1}}async function me(e){if(u!==void 0)return u;e!==void 0&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),e===void 0&&(e=new URL(""+new URL("nes_wasm_bg-ChsPVxDW.wasm",import.meta.url).href,import.meta.url));const t=ne();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:s}=await fe(await e,t);return de(n)}const m={A:0,B:1,Select:2,Start:3,Up:4,Down:5,Left:6,Right:7};let c=null,b=null,X=null,L=null,M=null,w=null,j=!1,T=null,k=null,N=null;const pe=4096;let A=0;async function ge(){if(await me(),c=new K,T=document.getElementById("rom-selector"),k=document.getElementById("gameboy-shell"),N=document.getElementById("power-led"),X=document.getElementById("screen"),!X){console.error("æ‰¾ä¸åˆ°ç•«å¸ƒå…ƒç´ ");return}if(L=X.getContext("2d"),!L){console.error("ç„¡æ³•å–å¾— Canvas 2D ä¸Šä¸‹æ–‡");return}M=L.createImageData(256,240),we(),Ee(),Re(),he(),Se(),console.log("H5-NES æ¨¡æ“¬å™¨å·²åˆå§‹åŒ–ï¼ˆWASM æ ¸å¿ƒï¼‰")}const G={KeyZ:m.A,KeyX:m.B,ShiftRight:m.Select,Enter:m.Start,ArrowUp:m.Up,ArrowDown:m.Down,ArrowLeft:m.Left,ArrowRight:m.Right};function we(){window.addEventListener("keydown",e=>{const t=G[e.code];t!==void 0&&c&&(c.setButton(0,t,!0),e.preventDefault())}),window.addEventListener("keyup",e=>{const t=G[e.code];t!==void 0&&c&&(c.setButton(0,t,!1),e.preventDefault())})}function he(){ye(),document.getElementById("rom-file-input")?.addEventListener("change",async t=>{const n=t.target.files?.[0];n&&await Q(n)})}async function ye(){const e=document.getElementById("rom-list");if(e)try{const n=await fetch("./roms.json");if(!n.ok)throw new Error("ç„¡æ³•è¼‰å…¥ ROM åˆ—è¡¨");const s=await n.json();_e(s.roms)}catch(t){console.error("è¼‰å…¥ ROM åˆ—è¡¨å¤±æ•—:",t),e.innerHTML=`
      <div class="rom-error">
        <p>âš ï¸ ç„¡æ³•è¼‰å…¥éŠæˆ²åˆ—è¡¨</p>
        <p>è«‹ä½¿ç”¨ä¸‹æ–¹æŒ‰éˆ•é¸æ“‡ ROM æª”æ¡ˆ</p>
      </div>
    `}}function _e(e){const t=document.getElementById("rom-list");if(!t)return;if(e.length===0){t.innerHTML='<div class="rom-empty">æ²’æœ‰å¯ç”¨çš„éŠæˆ²</div>';return}t.innerHTML=e.map((s,r)=>`
    <button class="rom-item" data-index="${r}" data-file="${encodeURIComponent(s.file)}">
      <span class="rom-icon">ğŸ®</span>
      <span class="rom-name">${s.name}</span>
      <span class="rom-arrow">â–¶</span>
    </button>
  `).join(""),t.querySelectorAll(".rom-item").forEach(s=>{s.addEventListener("click",async()=>{const r=decodeURIComponent(s.dataset.file||"");r&&await ve(r)})})}async function ve(e){try{const n=await fetch(`./roms/${encodeURIComponent(e)}`);if(!n.ok)throw new Error(`ç„¡æ³•è¼‰å…¥ ROM: ${e}`);const s=await n.arrayBuffer();ee(s)}catch(t){console.error("è¼‰å…¥ ROM å¤±æ•—:",t),alert("è¼‰å…¥éŠæˆ²å¤±æ•—ï¼Œè«‹é‡è©¦")}}async function Q(e){try{const t=await e.arrayBuffer();ee(t)}catch(t){console.error("è¼‰å…¥ ROM å¤±æ•—:",t),alert("è¼‰å…¥éŠæˆ²å¤±æ•—ï¼Œè«‹é‡è©¦")}}function ee(e){if(!c)return;const t=new Uint8Array(e);c.loadRom(t)?(console.log("ROM è¼‰å…¥æˆåŠŸï¼Œé–‹å§‹åŸ·è¡Œ"),be(),w&&(c.setAudioSampleRate(w.sampleRate),$()),N?.classList.add("on"),z()):(console.error("ROM è¼‰å…¥å¤±æ•—"),alert("ç„¡æ³•è¼‰å…¥æ­¤ ROM æª”æ¡ˆ"))}function be(){T&&(T.style.display="none"),k&&(k.style.display="flex")}function Y(){V(),N?.classList.remove("on"),T&&(T.style.display="flex"),k&&(k.style.display="none")}const h=new Map;let R={up:!1,down:!1,left:!1,right:!1};function Ee(){Le(),Be(),Ae(),document.getElementById("virtual-controller")?.addEventListener("touchmove",t=>{t.preventDefault()},{passive:!1})}function Le(){const e=document.getElementById("dpad-touch-area"),t=document.getElementById("dpad");if(!e||!t)return;const n=a=>{const o=t.getBoundingClientRect(),d=o.left+o.width/2,f=o.top+o.height/2,p=a.clientX-d,g=a.clientY-f,E=Math.sqrt(p*p+g*g),B=o.width/2*.15,l={up:!1,down:!1,left:!1,right:!1};if(E>B){const i=Math.atan2(g,p)*180/Math.PI;i>=-22.5&&i<22.5?l.right=!0:i>=22.5&&i<67.5?(l.right=!0,l.down=!0):i>=67.5&&i<112.5?l.down=!0:i>=112.5&&i<157.5?(l.left=!0,l.down=!0):i>=157.5||i<-157.5?l.left=!0:i>=-157.5&&i<-112.5?(l.left=!0,l.up=!0):i>=-112.5&&i<-67.5?l.up=!0:i>=-67.5&&i<-22.5&&(l.right=!0,l.up=!0)}P(l)},s=()=>{P({up:!1,down:!1,left:!1,right:!1})};e.addEventListener("touchstart",a=>{a.preventDefault();for(const o of Array.from(a.changedTouches))h.set(o.identifier,{identifier:o.identifier,element:"dpad"}),n(o)},{passive:!1}),e.addEventListener("touchmove",a=>{a.preventDefault();for(const o of Array.from(a.changedTouches))h.get(o.identifier)?.element==="dpad"&&n(o)},{passive:!1}),e.addEventListener("touchend",a=>{a.preventDefault();for(const o of Array.from(a.changedTouches))h.get(o.identifier)?.element==="dpad"&&(h.delete(o.identifier),Array.from(h.values()).filter(f=>f.element==="dpad").length===0&&s())},{passive:!1}),e.addEventListener("touchcancel",a=>{a.preventDefault();for(const o of Array.from(a.changedTouches))h.delete(o.identifier);s()},{passive:!1});let r=!1;e.addEventListener("mousedown",a=>{a.preventDefault(),r=!0;const o=t.getBoundingClientRect(),d=o.left+o.width/2,f=o.top+o.height/2,p=a.clientX-d,g=a.clientY-f,E=Math.sqrt(p*p+g*g),B=o.width/2*.15,l={up:!1,down:!1,left:!1,right:!1};if(E>B){const i=Math.atan2(g,p)*180/Math.PI;i>=-22.5&&i<22.5?l.right=!0:i>=22.5&&i<67.5?(l.right=!0,l.down=!0):i>=67.5&&i<112.5?l.down=!0:i>=112.5&&i<157.5?(l.left=!0,l.down=!0):i>=157.5||i<-157.5?l.left=!0:i>=-157.5&&i<-112.5?(l.left=!0,l.up=!0):i>=-112.5&&i<-67.5?l.up=!0:i>=-67.5&&i<-22.5&&(l.right=!0,l.up=!0)}P(l)}),document.addEventListener("mousemove",a=>{if(!r)return;const o=t.getBoundingClientRect(),d=o.left+o.width/2,f=o.top+o.height/2,p=a.clientX-d,g=a.clientY-f,E=Math.sqrt(p*p+g*g),U=o.width/2,B=U*.15,l={up:!1,down:!1,left:!1,right:!1};if(E>B&&E<U*1.5){const i=Math.atan2(g,p)*180/Math.PI;i>=-22.5&&i<22.5?l.right=!0:i>=22.5&&i<67.5?(l.right=!0,l.down=!0):i>=67.5&&i<112.5?l.down=!0:i>=112.5&&i<157.5?(l.left=!0,l.down=!0):i>=157.5||i<-157.5?l.left=!0:i>=-157.5&&i<-112.5?(l.left=!0,l.up=!0):i>=-112.5&&i<-67.5?l.up=!0:i>=-67.5&&i<-22.5&&(l.right=!0,l.up=!0)}P(l)}),document.addEventListener("mouseup",()=>{r&&(r=!1,s())})}function P(e){e.up!==R.up&&c?.setButton(0,m.Up,e.up),e.down!==R.down&&c?.setButton(0,m.Down,e.down),e.left!==R.left&&c?.setButton(0,m.Left,e.left),e.right!==R.right&&c?.setButton(0,m.Right,e.right),document.getElementById("dpad-up")?.classList.toggle("pressed",e.up),document.getElementById("dpad-down")?.classList.toggle("pressed",e.down),document.getElementById("dpad-left")?.classList.toggle("pressed",e.left),document.getElementById("dpad-right")?.classList.toggle("pressed",e.right),R={...e}}function Be(){const e=document.getElementById("btn-a"),t=document.getElementById("btn-b"),n=(s,r,a)=>{s&&(s.addEventListener("touchstart",o=>{o.preventDefault(),o.stopPropagation();for(const d of Array.from(o.changedTouches))h.set(d.identifier,{identifier:d.identifier,element:a});c?.setButton(0,r,!0),s.classList.add("pressed")},{passive:!1}),s.addEventListener("touchend",o=>{o.preventDefault(),o.stopPropagation();for(const d of Array.from(o.changedTouches))h.delete(d.identifier);c?.setButton(0,r,!1),s.classList.remove("pressed")},{passive:!1}),s.addEventListener("touchcancel",o=>{o.preventDefault();for(const d of Array.from(o.changedTouches))h.delete(d.identifier);c?.setButton(0,r,!1),s.classList.remove("pressed")},{passive:!1}),s.addEventListener("mousedown",o=>{o.preventDefault(),c?.setButton(0,r,!0),s.classList.add("pressed")}),s.addEventListener("mouseup",o=>{o.preventDefault(),c?.setButton(0,r,!1),s.classList.remove("pressed")}),s.addEventListener("mouseleave",()=>{c?.setButton(0,r,!1),s.classList.remove("pressed")}))};n(e,m.A,"a"),n(t,m.B,"b")}function Ae(){document.querySelectorAll('[data-btn="select"], [data-btn="start"]').forEach(t=>{const n=t,r=n.dataset.btn==="start"?m.Start:m.Select;n.addEventListener("touchstart",a=>{a.preventDefault(),c?.setButton(0,r,!0),n.classList.add("pressed")},{passive:!1}),n.addEventListener("touchend",a=>{a.preventDefault(),c?.setButton(0,r,!1),n.classList.remove("pressed")},{passive:!1}),n.addEventListener("touchcancel",a=>{a.preventDefault(),c?.setButton(0,r,!1),n.classList.remove("pressed")},{passive:!1}),n.addEventListener("mousedown",a=>{a.preventDefault(),c?.setButton(0,r,!0),n.classList.add("pressed")}),n.addEventListener("mouseup",a=>{a.preventDefault(),c?.setButton(0,r,!1),n.classList.remove("pressed")}),n.addEventListener("mouseleave",()=>{c?.setButton(0,r,!1),n.classList.remove("pressed")})})}function Re(){document.getElementById("btn-pause")?.addEventListener("click",V),document.getElementById("btn-resume")?.addEventListener("click",z),document.getElementById("btn-reset")?.addEventListener("click",()=>c?.reset()),document.getElementById("btn-select-game")?.addEventListener("click",Y),document.getElementById("btn-save-state")?.addEventListener("click",()=>{O(0)?_("âœ… å­˜æª”æˆåŠŸ"):_("âŒ å­˜æª”å¤±æ•—")}),document.getElementById("btn-load-state")?.addEventListener("click",()=>{C(0)?_("âœ… è®€å–æˆåŠŸ"):_("âŒ æ²’æœ‰å­˜æª”")}),document.getElementById("mobile-save-state")?.addEventListener("click",()=>{O(0)?_("âœ… å­˜æª”æˆåŠŸ"):_("âŒ å­˜æª”å¤±æ•—")}),document.getElementById("mobile-load-state")?.addEventListener("click",()=>{C(0)?_("âœ… è®€å–æˆåŠŸ"):_("âŒ æ²’æœ‰å­˜æª”")})}function Se(){document.getElementById("rom-input")?.addEventListener("change",async t=>{const s=t.target.files?.[0];s&&await Q(s)})}function z(){b!==null&&cancelAnimationFrame(b),j=!0;const e=1e3/60.0988;let t=performance.now(),n=0;const s=r=>{if(!c||!L||!M||!j)return;const a=r-t;for(t=r,n+=a,n>e*3&&(n=e);n>=e;)c.frame(),n-=e;De(),b=requestAnimationFrame(s)};b=requestAnimationFrame(s)}function V(){j=!1,b!==null&&(cancelAnimationFrame(b),b=null)}function De(){if(!c||!L||!M)return;const e=c.getWasmMemory(),t=c.getFrameBufferPtr(),n=c.getFrameBufferLen(),s=new Uint8Array(e.buffer,t,n);M.data.set(s),L.putImageData(M,0,0)}async function Ie(){try{w=new AudioContext({sampleRate:44100}),c&&c.setAudioSampleRate(w.sampleRate);const e=w.createScriptProcessor(pe,0,1);e.onaudioprocess=t=>{const n=t.outputBuffer.getChannelData(0);if(c&&j){const s=c.getAudioBufferLen();if(s>0){const r=c.getWasmMemory(),a=c.getAudioBufferPtr(),o=new Float32Array(r.buffer,a,s),d=Math.min(s,n.length);for(let f=0;f<d;f++)n[f]=o[f];A=o[d-1];for(let f=d;f<n.length;f++)A*=.999,n[f]=A;c.consumeAudioSamples()}else for(let r=0;r<n.length;r++)A*=.999,n[r]=A}else n.fill(0)},e.connect(w.destination),console.log("éŸ³é »ç³»çµ±å·²åˆå§‹åŒ–ï¼Œå–æ¨£ç‡:",w.sampleRate)}catch(e){console.error("éŸ³é »åˆå§‹åŒ–å¤±æ•—:",e)}}function $(){w&&w.state==="suspended"&&w.resume()}const te="nes_savestate_";function _(e){const t=document.querySelector(".toast-message");t&&t.remove();const n=document.createElement("div");if(n.className="toast-message",n.textContent=e,n.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 15px 30px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: bold;
    z-index: 10000;
    animation: toastFade 1.5s ease-out forwards;
  `,!document.querySelector("#toast-style")){const s=document.createElement("style");s.id="toast-style",s.textContent=`
      @keyframes toastFade {
        0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        70% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
      }
    `,document.head.appendChild(s)}document.body.appendChild(n),setTimeout(()=>n.remove(),1500)}function O(e=0){if(!c)return!1;try{const t=c.exportSaveState(),n=`${te}${e}`;return localStorage.setItem(n,t),console.log(`å­˜æª”æˆåŠŸ (Slot ${e})`),!0}catch(t){return console.error("å­˜æª”å¤±æ•—:",t),!1}}function C(e=0){if(!c)return!1;try{const t=`${te}${e}`,n=localStorage.getItem(t);if(!n)return console.log(`Slot ${e} æ²’æœ‰å­˜æª”`),!1;const s=c.importSaveState(n);return s&&console.log(`è®€å–å­˜æª”æˆåŠŸ (Slot ${e})`),s}catch(t){return console.error("è®€å–å­˜æª”å¤±æ•—:",t),!1}}function xe(){if(!c)return;const e=c.exportSaveState(),t=new Blob([e],{type:"text/plain"}),n=URL.createObjectURL(t),s=document.createElement("a");s.href=n,s.download=`nes_savestate_${Date.now()}.txt`,s.click(),URL.revokeObjectURL(n)}function Me(){document.addEventListener("keydown",e=>{if(e.key==="F5"&&(e.preventDefault(),O(0)),e.key==="F7"&&(e.preventDefault(),C(0)),e.key>="F1"&&e.key<="F4"&&e.shiftKey){e.preventDefault();const t=parseInt(e.key[1]);O(t)}if(e.key>="1"&&e.key<="4"&&e.ctrlKey){e.preventDefault();const t=parseInt(e.key);C(t)}e.key==="Escape"&&Y()})}window.nes=null;window.startEmulation=z;window.stopEmulation=V;window.saveState=O;window.loadState=C;window.exportSaveToFile=xe;window.showRomSelector=Y;document.addEventListener("DOMContentLoaded",async()=>{await ge(),await Ie(),Me(),window.nes=c,document.addEventListener("click",$,{once:!0}),document.addEventListener("keydown",$,{once:!0}),document.addEventListener("touchstart",$,{once:!0})});
//# sourceMappingURL=index-BC5SYLZM.js.map
