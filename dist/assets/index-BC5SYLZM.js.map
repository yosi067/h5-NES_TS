{"version":3,"file":"index-BC5SYLZM.js","sources":["../../nes-wasm/pkg/nes_wasm.js","../../src/main.ts"],"sourcesContent":["/* @ts-self-types=\"./nes_wasm.d.ts\" */\n\n/**\n * NES æ¨¡æ“¬å™¨ WASM åŒ…è£å™¨\n * é€™æ˜¯æš´éœ²çµ¦ JavaScript çš„ä¸»è¦ä»‹é¢\n */\nexport class NesWasm {\n    __destroy_into_raw() {\n        const ptr = this.__wbg_ptr;\n        this.__wbg_ptr = 0;\n        NesWasmFinalization.unregister(this);\n        return ptr;\n    }\n    free() {\n        const ptr = this.__destroy_into_raw();\n        wasm.__wbg_neswasm_free(ptr, 0);\n    }\n    /**\n     * æ¶ˆè²»éŸ³é »å–æ¨£ï¼ˆè®€å–å¾Œæ¸…é™¤ç·©è¡å€ï¼‰\n     * @returns {number}\n     */\n    consumeAudioSamples() {\n        const ret = wasm.neswasm_consumeAudioSamples(this.__wbg_ptr);\n        return ret >>> 0;\n    }\n    /**\n     * åŒ¯å‡ºå­˜æª”è³‡æ–™ç‚º JSON å­—ä¸²\n     * @returns {string}\n     */\n    exportSaveState() {\n        let deferred1_0;\n        let deferred1_1;\n        try {\n            const retptr = wasm.__wbindgen_add_to_stack_pointer(-16);\n            wasm.neswasm_exportSaveState(retptr, this.__wbg_ptr);\n            var r0 = getDataViewMemory0().getInt32(retptr + 4 * 0, true);\n            var r1 = getDataViewMemory0().getInt32(retptr + 4 * 1, true);\n            deferred1_0 = r0;\n            deferred1_1 = r1;\n            return getStringFromWasm0(r0, r1);\n        } finally {\n            wasm.__wbindgen_add_to_stack_pointer(16);\n            wasm.__wbindgen_export(deferred1_0, deferred1_1, 1);\n        }\n    }\n    /**\n     * åŸ·è¡Œä¸€å¹€ï¼ˆåŒ…å«æ‰€æœ‰ CPU/PPU/APU é€±æœŸï¼‰\n     */\n    frame() {\n        wasm.neswasm_frame(this.__wbg_ptr);\n    }\n    /**\n     * å–å¾—å¯ç”¨çš„éŸ³é »å–æ¨£æ•¸\n     * @returns {number}\n     */\n    getAudioBufferLen() {\n        const ret = wasm.neswasm_getAudioBufferLen(this.__wbg_ptr);\n        return ret >>> 0;\n    }\n    /**\n     * å–å¾—éŸ³é »ç·©è¡å€æŒ‡æ¨™\n     * @returns {number}\n     */\n    getAudioBufferPtr() {\n        const ret = wasm.neswasm_getAudioBufferPtr(this.__wbg_ptr);\n        return ret >>> 0;\n    }\n    /**\n     * å–å¾—ç•«é¢ç·©è¡å€é•·åº¦ï¼ˆä½å…ƒçµ„æ•¸ï¼‰\n     * @returns {number}\n     */\n    getFrameBufferLen() {\n        const ret = wasm.neswasm_getFrameBufferLen(this.__wbg_ptr);\n        return ret >>> 0;\n    }\n    /**\n     * å–å¾—ç•«é¢ç·©è¡å€æŒ‡æ¨™ï¼ˆ256x240 çš„ RGBA åƒç´ è³‡æ–™ï¼‰\n     * å›å‚³çš„æ˜¯ WASM è¨˜æ†¶é«”ä¸­çš„æŒ‡æ¨™ï¼ŒJavaScript å¯ç›´æ¥å­˜å–\n     * @returns {number}\n     */\n    getFrameBufferPtr() {\n        const ret = wasm.neswasm_getFrameBufferPtr(this.__wbg_ptr);\n        return ret >>> 0;\n    }\n    /**\n     * å–å¾— WASM è¨˜æ†¶é«”ï¼ˆä¾› JavaScript ç›´æ¥å­˜å–ç•«é¢/éŸ³é »ç·©è¡å€ï¼‰\n     * @returns {any}\n     */\n    getWasmMemory() {\n        const ret = wasm.neswasm_getWasmMemory(this.__wbg_ptr);\n        return takeObject(ret);\n    }\n    /**\n     * å¾ JSON å­—ä¸²åŒ¯å…¥å­˜æª”\n     * @param {string} json\n     * @returns {boolean}\n     */\n    importSaveState(json) {\n        const ptr0 = passStringToWasm0(json, wasm.__wbindgen_export2, wasm.__wbindgen_export3);\n        const len0 = WASM_VECTOR_LEN;\n        const ret = wasm.neswasm_importSaveState(this.__wbg_ptr, ptr0, len0);\n        return ret !== 0;\n    }\n    /**\n     * è¼‰å…¥ ROM è³‡æ–™\n     * å‚³å…¥ ROM çš„ Uint8Arrayï¼Œå›å‚³æ˜¯å¦è¼‰å…¥æˆåŠŸ\n     * @param {Uint8Array} rom_data\n     * @returns {boolean}\n     */\n    loadRom(rom_data) {\n        const ptr0 = passArray8ToWasm0(rom_data, wasm.__wbindgen_export2);\n        const len0 = WASM_VECTOR_LEN;\n        const ret = wasm.neswasm_loadRom(this.__wbg_ptr, ptr0, len0);\n        return ret !== 0;\n    }\n    /**\n     * å»ºç«‹æ–°çš„ NES æ¨¡æ“¬å™¨å¯¦ä¾‹\n     */\n    constructor() {\n        const ret = wasm.neswasm_new();\n        this.__wbg_ptr = ret >>> 0;\n        NesWasmFinalization.register(this, this.__wbg_ptr, this);\n        return this;\n    }\n    /**\n     * é‡ç½®æ¨¡æ“¬å™¨\n     */\n    reset() {\n        wasm.neswasm_reset(this.__wbg_ptr);\n    }\n    /**\n     * è¨­å®šéŸ³é »å–æ¨£ç‡\n     * @param {number} rate\n     */\n    setAudioSampleRate(rate) {\n        wasm.neswasm_setAudioSampleRate(this.__wbg_ptr, rate);\n    }\n    /**\n     * è¨­å®šæ§åˆ¶å™¨æŒ‰éˆ•ç‹€æ…‹\n     * controller: æ§åˆ¶å™¨ç·¨è™Ÿï¼ˆ0 æˆ– 1ï¼‰\n     * button: æŒ‰éˆ•ç·¨è™Ÿï¼ˆ0=A, 1=B, 2=Select, 3=Start, 4=Up, 5=Down, 6=Left, 7=Rightï¼‰\n     * pressed: æ˜¯å¦æŒ‰ä¸‹\n     * @param {number} controller\n     * @param {number} button\n     * @param {boolean} pressed\n     */\n    setButton(controller, button, pressed) {\n        wasm.neswasm_setButton(this.__wbg_ptr, controller, button, pressed);\n    }\n}\nif (Symbol.dispose) NesWasm.prototype[Symbol.dispose] = NesWasm.prototype.free;\n\nfunction __wbg_get_imports() {\n    const import0 = {\n        __proto__: null,\n        __wbg___wbindgen_memory_bd1fbcf21fbef3c8: function() {\n            const ret = wasm.memory;\n            return addHeapObject(ret);\n        },\n        __wbg___wbindgen_throw_be289d5034ed271b: function(arg0, arg1) {\n            throw new Error(getStringFromWasm0(arg0, arg1));\n        },\n    };\n    return {\n        __proto__: null,\n        \"./nes_wasm_bg.js\": import0,\n    };\n}\n\nconst NesWasmFinalization = (typeof FinalizationRegistry === 'undefined')\n    ? { register: () => {}, unregister: () => {} }\n    : new FinalizationRegistry(ptr => wasm.__wbg_neswasm_free(ptr >>> 0, 1));\n\nfunction addHeapObject(obj) {\n    if (heap_next === heap.length) heap.push(heap.length + 1);\n    const idx = heap_next;\n    heap_next = heap[idx];\n\n    heap[idx] = obj;\n    return idx;\n}\n\nfunction dropObject(idx) {\n    if (idx < 132) return;\n    heap[idx] = heap_next;\n    heap_next = idx;\n}\n\nlet cachedDataViewMemory0 = null;\nfunction getDataViewMemory0() {\n    if (cachedDataViewMemory0 === null || cachedDataViewMemory0.buffer.detached === true || (cachedDataViewMemory0.buffer.detached === undefined && cachedDataViewMemory0.buffer !== wasm.memory.buffer)) {\n        cachedDataViewMemory0 = new DataView(wasm.memory.buffer);\n    }\n    return cachedDataViewMemory0;\n}\n\nfunction getStringFromWasm0(ptr, len) {\n    ptr = ptr >>> 0;\n    return decodeText(ptr, len);\n}\n\nlet cachedUint8ArrayMemory0 = null;\nfunction getUint8ArrayMemory0() {\n    if (cachedUint8ArrayMemory0 === null || cachedUint8ArrayMemory0.byteLength === 0) {\n        cachedUint8ArrayMemory0 = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachedUint8ArrayMemory0;\n}\n\nfunction getObject(idx) { return heap[idx]; }\n\nlet heap = new Array(128).fill(undefined);\nheap.push(undefined, null, true, false);\n\nlet heap_next = heap.length;\n\nfunction passArray8ToWasm0(arg, malloc) {\n    const ptr = malloc(arg.length * 1, 1) >>> 0;\n    getUint8ArrayMemory0().set(arg, ptr / 1);\n    WASM_VECTOR_LEN = arg.length;\n    return ptr;\n}\n\nfunction passStringToWasm0(arg, malloc, realloc) {\n    if (realloc === undefined) {\n        const buf = cachedTextEncoder.encode(arg);\n        const ptr = malloc(buf.length, 1) >>> 0;\n        getUint8ArrayMemory0().subarray(ptr, ptr + buf.length).set(buf);\n        WASM_VECTOR_LEN = buf.length;\n        return ptr;\n    }\n\n    let len = arg.length;\n    let ptr = malloc(len, 1) >>> 0;\n\n    const mem = getUint8ArrayMemory0();\n\n    let offset = 0;\n\n    for (; offset < len; offset++) {\n        const code = arg.charCodeAt(offset);\n        if (code > 0x7F) break;\n        mem[ptr + offset] = code;\n    }\n    if (offset !== len) {\n        if (offset !== 0) {\n            arg = arg.slice(offset);\n        }\n        ptr = realloc(ptr, len, len = offset + arg.length * 3, 1) >>> 0;\n        const view = getUint8ArrayMemory0().subarray(ptr + offset, ptr + len);\n        const ret = cachedTextEncoder.encodeInto(arg, view);\n\n        offset += ret.written;\n        ptr = realloc(ptr, len, offset, 1) >>> 0;\n    }\n\n    WASM_VECTOR_LEN = offset;\n    return ptr;\n}\n\nfunction takeObject(idx) {\n    const ret = getObject(idx);\n    dropObject(idx);\n    return ret;\n}\n\nlet cachedTextDecoder = new TextDecoder('utf-8', { ignoreBOM: true, fatal: true });\ncachedTextDecoder.decode();\nconst MAX_SAFARI_DECODE_BYTES = 2146435072;\nlet numBytesDecoded = 0;\nfunction decodeText(ptr, len) {\n    numBytesDecoded += len;\n    if (numBytesDecoded >= MAX_SAFARI_DECODE_BYTES) {\n        cachedTextDecoder = new TextDecoder('utf-8', { ignoreBOM: true, fatal: true });\n        cachedTextDecoder.decode();\n        numBytesDecoded = len;\n    }\n    return cachedTextDecoder.decode(getUint8ArrayMemory0().subarray(ptr, ptr + len));\n}\n\nconst cachedTextEncoder = new TextEncoder();\n\nif (!('encodeInto' in cachedTextEncoder)) {\n    cachedTextEncoder.encodeInto = function (arg, view) {\n        const buf = cachedTextEncoder.encode(arg);\n        view.set(buf);\n        return {\n            read: arg.length,\n            written: buf.length\n        };\n    };\n}\n\nlet WASM_VECTOR_LEN = 0;\n\nlet wasmModule, wasm;\nfunction __wbg_finalize_init(instance, module) {\n    wasm = instance.exports;\n    wasmModule = module;\n    cachedDataViewMemory0 = null;\n    cachedUint8ArrayMemory0 = null;\n    return wasm;\n}\n\nasync function __wbg_load(module, imports) {\n    if (typeof Response === 'function' && module instanceof Response) {\n        if (typeof WebAssembly.instantiateStreaming === 'function') {\n            try {\n                return await WebAssembly.instantiateStreaming(module, imports);\n            } catch (e) {\n                const validResponse = module.ok && expectedResponseType(module.type);\n\n                if (validResponse && module.headers.get('Content-Type') !== 'application/wasm') {\n                    console.warn(\"`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\\n\", e);\n\n                } else { throw e; }\n            }\n        }\n\n        const bytes = await module.arrayBuffer();\n        return await WebAssembly.instantiate(bytes, imports);\n    } else {\n        const instance = await WebAssembly.instantiate(module, imports);\n\n        if (instance instanceof WebAssembly.Instance) {\n            return { instance, module };\n        } else {\n            return instance;\n        }\n    }\n\n    function expectedResponseType(type) {\n        switch (type) {\n            case 'basic': case 'cors': case 'default': return true;\n        }\n        return false;\n    }\n}\n\nfunction initSync(module) {\n    if (wasm !== undefined) return wasm;\n\n\n    if (module !== undefined) {\n        if (Object.getPrototypeOf(module) === Object.prototype) {\n            ({module} = module)\n        } else {\n            console.warn('using deprecated parameters for `initSync()`; pass a single object instead')\n        }\n    }\n\n    const imports = __wbg_get_imports();\n    if (!(module instanceof WebAssembly.Module)) {\n        module = new WebAssembly.Module(module);\n    }\n    const instance = new WebAssembly.Instance(module, imports);\n    return __wbg_finalize_init(instance, module);\n}\n\nasync function __wbg_init(module_or_path) {\n    if (wasm !== undefined) return wasm;\n\n\n    if (module_or_path !== undefined) {\n        if (Object.getPrototypeOf(module_or_path) === Object.prototype) {\n            ({module_or_path} = module_or_path)\n        } else {\n            console.warn('using deprecated parameters for the initialization function; pass a single object instead')\n        }\n    }\n\n    if (module_or_path === undefined) {\n        module_or_path = new URL('nes_wasm_bg.wasm', import.meta.url);\n    }\n    const imports = __wbg_get_imports();\n\n    if (typeof module_or_path === 'string' || (typeof Request === 'function' && module_or_path instanceof Request) || (typeof URL === 'function' && module_or_path instanceof URL)) {\n        module_or_path = fetch(module_or_path);\n    }\n\n    const { instance, module } = await __wbg_load(await module_or_path, imports);\n\n    return __wbg_finalize_init(instance, module);\n}\n\nexport { initSync, __wbg_init as default };\n","/**\n * H5-NES æ¨¡æ“¬å™¨ä¸»ç¨‹å¼å…¥å£ï¼ˆWASM ç‰ˆæœ¬ï¼‰\n * \n * åŠŸèƒ½ï¼š\n * - GameBoy é¢¨æ ¼ UIï¼ˆå®Œæ•´ä¿ç•™ï¼‰\n * - ROM é¸æ“‡å™¨\n * - è™›æ“¬æ§åˆ¶å™¨ (æ‰‹æ©Ÿç‰ˆ)\n * - RWD éŸ¿æ‡‰å¼è¨­è¨ˆ\n * - ä½¿ç”¨ Rust/WASM æ ¸å¿ƒå–ä»£ TypeScript ç¡¬é«”æ¨¡æ“¬\n */\n\nimport init, { NesWasm } from '../nes-wasm/pkg/nes_wasm.js';\n\n// ===== å‹åˆ¥å®šç¾© =====\n\ninterface RomInfo {\n  name: string;\n  file: string;\n}\n\ninterface RomListResponse {\n  roms: RomInfo[];\n}\n\n// æ§åˆ¶å™¨æŒ‰éˆ•ç·¨è™Ÿï¼ˆèˆ‡ Rust ç«¯ä¸€è‡´ï¼‰\nconst ControllerButton = {\n  A: 0,\n  B: 1,\n  Select: 2,\n  Start: 3,\n  Up: 4,\n  Down: 5,\n  Left: 6,\n  Right: 7,\n} as const;\ntype ControllerButton = typeof ControllerButton[keyof typeof ControllerButton];\n\n// ===== å…¨åŸŸè®Šæ•¸ =====\n\nlet nes: NesWasm | null = null;\nlet animationId: number | null = null;\nlet canvas: HTMLCanvasElement | null = null;\nlet ctx: CanvasRenderingContext2D | null = null;\nlet imageData: ImageData | null = null;\nlet audioContext: AudioContext | null = null;\nlet isRunning: boolean = false;\n\n// ===== UI å…ƒç´  =====\n\nlet romSelector: HTMLElement | null = null;\nlet gameboyShell: HTMLElement | null = null;\nlet powerLed: HTMLElement | null = null;\n\n// ===== éŸ³é »è¨­å®š =====\nconst AUDIO_BUFFER_SIZE = 4096;\nlet lastAudioSample: number = 0;  // ä¸Šä¸€å€‹æœ‰æ•ˆå–æ¨£å€¼ï¼Œç”¨æ–¼å¹³æ»‘å¡«å……\n\n// ===== åˆå§‹åŒ– =====\n\n/**\n * åˆå§‹åŒ–æ¨¡æ“¬å™¨ï¼ˆè¼‰å…¥ WASM æ¨¡çµ„ï¼‰\n */\nasync function initWasm(): Promise<void> {\n  // åˆå§‹åŒ– WASM æ¨¡çµ„\n  await init();\n  \n  // å»ºç«‹ NES å¯¦ä¾‹\n  nes = new NesWasm();\n\n  // å–å¾— UI å…ƒç´ \n  romSelector = document.getElementById('rom-selector');\n  gameboyShell = document.getElementById('gameboy-shell');\n  powerLed = document.getElementById('power-led');\n  \n  // å»ºç«‹ç•«å¸ƒ\n  canvas = document.getElementById('screen') as HTMLCanvasElement;\n  if (!canvas) {\n    console.error('æ‰¾ä¸åˆ°ç•«å¸ƒå…ƒç´ ');\n    return;\n  }\n\n  ctx = canvas.getContext('2d');\n  if (!ctx) {\n    console.error('ç„¡æ³•å–å¾— Canvas 2D ä¸Šä¸‹æ–‡');\n    return;\n  }\n\n  imageData = ctx.createImageData(256, 240);\n\n  // è¨­å®šéµç›¤è¼¸å…¥ï¼ˆç›´æ¥å° WASM æ§åˆ¶å™¨æ“ä½œï¼‰\n  setupKeyboardInput();\n\n  // è¨­å®šè™›æ“¬æ§åˆ¶å™¨\n  setupVirtualController();\n\n  // è¨­å®šé›»è…¦ç‰ˆæ§åˆ¶æŒ‰éˆ•\n  setupDesktopControls();\n\n  // è¨­å®š ROM é¸æ“‡å™¨\n  setupRomSelector();\n\n  // è¨­å®šæª”æ¡ˆé¸æ“‡å™¨\n  setupFileInput();\n\n  console.log('H5-NES æ¨¡æ“¬å™¨å·²åˆå§‹åŒ–ï¼ˆWASM æ ¸å¿ƒï¼‰');\n}\n\n// ===== éµç›¤è¼¸å…¥ =====\n\n/** éµç›¤æ˜ å°„ (ç©å®¶ 1) */\nconst KEYBOARD_MAP_P1: Record<string, ControllerButton> = {\n  'KeyZ': ControllerButton.A,\n  'KeyX': ControllerButton.B,\n  'ShiftRight': ControllerButton.Select,\n  'Enter': ControllerButton.Start,\n  'ArrowUp': ControllerButton.Up,\n  'ArrowDown': ControllerButton.Down,\n  'ArrowLeft': ControllerButton.Left,\n  'ArrowRight': ControllerButton.Right,\n};\n\nfunction setupKeyboardInput(): void {\n  window.addEventListener('keydown', (e) => {\n    const button = KEYBOARD_MAP_P1[e.code];\n    if (button !== undefined && nes) {\n      nes.setButton(0, button, true);\n      e.preventDefault();\n    }\n  });\n  window.addEventListener('keyup', (e) => {\n    const button = KEYBOARD_MAP_P1[e.code];\n    if (button !== undefined && nes) {\n      nes.setButton(0, button, false);\n      e.preventDefault();\n    }\n  });\n}\n\n// ===== ROM é¸æ“‡å™¨ =====\n\n/**\n * è¨­å®š ROM é¸æ“‡å™¨\n */\nfunction setupRomSelector(): void {\n  loadRomList();\n  \n  // è¨­å®šæª”æ¡ˆä¸Šå‚³\n  const fileInput = document.getElementById('rom-file-input') as HTMLInputElement;\n  fileInput?.addEventListener('change', async (e) => {\n    const file = (e.target as HTMLInputElement).files?.[0];\n    if (file) {\n      await loadRomFromFile(file);\n    }\n  });\n}\n\n/**\n * è¼‰å…¥ ROM åˆ—è¡¨\n */\nasync function loadRomList(): Promise<void> {\n  const romListEl = document.getElementById('rom-list');\n  if (!romListEl) return;\n\n  try {\n    // ä½¿ç”¨ Vite çš„ BASE_URL ç¢ºä¿åœ¨ GitHub Pages ç­‰å­ç›®éŒ„éƒ¨ç½²æ™‚è·¯å¾‘æ­£ç¢º\n    const baseUrl = import.meta.env.BASE_URL;\n    const response = await fetch(`${baseUrl}roms.json`);\n    if (!response.ok) {\n      throw new Error('ç„¡æ³•è¼‰å…¥ ROM åˆ—è¡¨');\n    }\n    \n    const data: RomListResponse = await response.json();\n    renderRomList(data.roms);\n  } catch (error) {\n    console.error('è¼‰å…¥ ROM åˆ—è¡¨å¤±æ•—:', error);\n    romListEl.innerHTML = `\n      <div class=\"rom-error\">\n        <p>âš ï¸ ç„¡æ³•è¼‰å…¥éŠæˆ²åˆ—è¡¨</p>\n        <p>è«‹ä½¿ç”¨ä¸‹æ–¹æŒ‰éˆ•é¸æ“‡ ROM æª”æ¡ˆ</p>\n      </div>\n    `;\n  }\n}\n\n/**\n * æ¸²æŸ“ ROM åˆ—è¡¨\n */\nfunction renderRomList(roms: RomInfo[]): void {\n  const romListEl = document.getElementById('rom-list');\n  if (!romListEl) return;\n\n  if (roms.length === 0) {\n    romListEl.innerHTML = '<div class=\"rom-empty\">æ²’æœ‰å¯ç”¨çš„éŠæˆ²</div>';\n    return;\n  }\n\n  romListEl.innerHTML = roms.map((rom, index) => `\n    <button class=\"rom-item\" data-index=\"${index}\" data-file=\"${encodeURIComponent(rom.file)}\">\n      <span class=\"rom-icon\">ğŸ®</span>\n      <span class=\"rom-name\">${rom.name}</span>\n      <span class=\"rom-arrow\">â–¶</span>\n    </button>\n  `).join('');\n\n  // ç¶å®šé»æ“Šäº‹ä»¶\n  const items = romListEl.querySelectorAll('.rom-item');\n  items.forEach(item => {\n    item.addEventListener('click', async () => {\n      const file = decodeURIComponent((item as HTMLElement).dataset.file || '');\n      if (file) {\n        await loadRomFromServer(file);\n      }\n    });\n  });\n}\n\n/**\n * å¾ä¼ºæœå™¨è¼‰å…¥ ROM\n */\nasync function loadRomFromServer(filename: string): Promise<void> {\n  try {\n    // ä½¿ç”¨ Vite çš„ BASE_URL ç¢ºä¿åœ¨ GitHub Pages ç­‰å­ç›®éŒ„éƒ¨ç½²æ™‚è·¯å¾‘æ­£ç¢º\n    const baseUrl = import.meta.env.BASE_URL;\n    const response = await fetch(`${baseUrl}roms/${encodeURIComponent(filename)}`);\n    if (!response.ok) {\n      throw new Error(`ç„¡æ³•è¼‰å…¥ ROM: ${filename}`);\n    }\n    \n    const buffer = await response.arrayBuffer();\n    startGame(buffer);\n  } catch (error) {\n    console.error('è¼‰å…¥ ROM å¤±æ•—:', error);\n    alert('è¼‰å…¥éŠæˆ²å¤±æ•—ï¼Œè«‹é‡è©¦');\n  }\n}\n\n/**\n * å¾æª”æ¡ˆè¼‰å…¥ ROM\n */\nasync function loadRomFromFile(file: File): Promise<void> {\n  try {\n    const buffer = await file.arrayBuffer();\n    startGame(buffer);\n  } catch (error) {\n    console.error('è¼‰å…¥ ROM å¤±æ•—:', error);\n    alert('è¼‰å…¥éŠæˆ²å¤±æ•—ï¼Œè«‹é‡è©¦');\n  }\n}\n\n/**\n * é–‹å§‹éŠæˆ²\n */\nfunction startGame(romData: ArrayBuffer): void {\n  if (!nes) return;\n\n  const romBytes = new Uint8Array(romData);\n  if (nes.loadRom(romBytes)) {\n    console.log('ROM è¼‰å…¥æˆåŠŸï¼Œé–‹å§‹åŸ·è¡Œ');\n    \n    // éš±è—é¸æ“‡å™¨ï¼Œé¡¯ç¤ºéŠæˆ²ç•«é¢\n    hideRomSelector();\n    \n    // ç¢ºä¿éŸ³é »ç³»çµ±è¨­å®šæ­£ç¢º\n    if (audioContext) {\n      nes.setAudioSampleRate(audioContext.sampleRate);\n      resumeAudio();\n    }\n    \n    // é–‹å•Ÿé›»æºæŒ‡ç¤ºç‡ˆ\n    powerLed?.classList.add('on');\n    \n    // é–‹å§‹æ¨¡æ“¬\n    startEmulation();\n  } else {\n    console.error('ROM è¼‰å…¥å¤±æ•—');\n    alert('ç„¡æ³•è¼‰å…¥æ­¤ ROM æª”æ¡ˆ');\n  }\n}\n\n/**\n * éš±è— ROM é¸æ“‡å™¨\n */\nfunction hideRomSelector(): void {\n  if (romSelector) romSelector.style.display = 'none';\n  if (gameboyShell) gameboyShell.style.display = 'flex';\n}\n\n/**\n * é¡¯ç¤º ROM é¸æ“‡å™¨\n */\nfunction showRomSelector(): void {\n  stopEmulation();\n  powerLed?.classList.remove('on');\n  if (romSelector) romSelector.style.display = 'flex';\n  if (gameboyShell) gameboyShell.style.display = 'none';\n}\n\n// ===== è™›æ“¬æ§åˆ¶å™¨ (å¤šé»è§¸æ§æ”¯æ´) =====\n\n// è¿½è¹¤æ´»èºçš„è§¸æ§é»\ninterface TouchState {\n  identifier: number;\n  element: string;  // 'dpad', 'a', 'b', 'start', 'select'\n}\n\nconst activeTouches: Map<number, TouchState> = new Map();\n\n// D-Pad æ–¹å‘ç‹€æ…‹\ninterface DpadState {\n  up: boolean;\n  down: boolean;\n  left: boolean;\n  right: boolean;\n}\n\nlet currentDpadState: DpadState = { up: false, down: false, left: false, right: false };\n\n/**\n * è¨­å®šè™›æ“¬æ§åˆ¶å™¨ (æ”¯æ´å¤šé»è§¸æ§)\n */\nfunction setupVirtualController(): void {\n  // è¨­å®š D-Pad è§¸æ§å€åŸŸ (æ”¯æ´æ–œå‘)\n  setupDpad();\n  \n  // è¨­å®š A/B æŒ‰éˆ• (æ”¯æ´åŒæ™‚æŒ‰)\n  setupABButtons();\n  \n  // è¨­å®šåŠŸèƒ½æŒ‰éˆ• (Select/Start)\n  setupFunctionButtons();\n\n  // é˜²æ­¢é é¢æ²å‹•\n  const virtualController = document.getElementById('virtual-controller');\n  virtualController?.addEventListener('touchmove', (e) => {\n    e.preventDefault();\n  }, { passive: false });\n}\n\n/**\n * è¨­å®š D-Pad (å€åŸŸåµæ¸¬ï¼Œæ”¯æ´æ–œå‘è¼¸å…¥)\n */\nfunction setupDpad(): void {\n  const dpadArea = document.getElementById('dpad-touch-area');\n  const dpad = document.getElementById('dpad');\n  if (!dpadArea || !dpad) return;\n\n  const updateDpadFromTouch = (touch: Touch) => {\n    const rect = dpad.getBoundingClientRect();\n    const centerX = rect.left + rect.width / 2;\n    const centerY = rect.top + rect.height / 2;\n    \n    const dx = touch.clientX - centerX;\n    const dy = touch.clientY - centerY;\n    \n    // è¨ˆç®—è·é›¢ä¸­å¿ƒçš„è·é›¢\n    const distance = Math.sqrt(dx * dx + dy * dy);\n    const maxRadius = rect.width / 2;\n    \n    // æ­»å€ï¼šè·é›¢ä¸­å¿ƒå¤ªè¿‘æ™‚ä¸è§¸ç™¼\n    const deadZone = maxRadius * 0.15;\n    \n    const newState: DpadState = { up: false, down: false, left: false, right: false };\n    \n    if (distance > deadZone) {\n      // è¨ˆç®—è§’åº¦ (-180 åˆ° 180)\n      const angle = Math.atan2(dy, dx) * 180 / Math.PI;\n      \n      // 45 åº¦åˆ†å‰²ï¼Œæ”¯æ´ 8 æ–¹å‘\n      // å³: -22.5 åˆ° 22.5\n      // å³ä¸‹: 22.5 åˆ° 67.5\n      // ä¸‹: 67.5 åˆ° 112.5\n      // å·¦ä¸‹: 112.5 åˆ° 157.5\n      // å·¦: 157.5 åˆ° 180 æˆ– -180 åˆ° -157.5\n      // å·¦ä¸Š: -157.5 åˆ° -112.5\n      // ä¸Š: -112.5 åˆ° -67.5\n      // å³ä¸Š: -67.5 åˆ° -22.5\n      \n      if (angle >= -22.5 && angle < 22.5) {\n        newState.right = true;\n      } else if (angle >= 22.5 && angle < 67.5) {\n        newState.right = true;\n        newState.down = true;\n      } else if (angle >= 67.5 && angle < 112.5) {\n        newState.down = true;\n      } else if (angle >= 112.5 && angle < 157.5) {\n        newState.left = true;\n        newState.down = true;\n      } else if (angle >= 157.5 || angle < -157.5) {\n        newState.left = true;\n      } else if (angle >= -157.5 && angle < -112.5) {\n        newState.left = true;\n        newState.up = true;\n      } else if (angle >= -112.5 && angle < -67.5) {\n        newState.up = true;\n      } else if (angle >= -67.5 && angle < -22.5) {\n        newState.right = true;\n        newState.up = true;\n      }\n    }\n    \n    applyDpadState(newState);\n  };\n\n  const clearDpad = () => {\n    const newState: DpadState = { up: false, down: false, left: false, right: false };\n    applyDpadState(newState);\n  };\n\n  // è§¸æ§é–‹å§‹\n  dpadArea.addEventListener('touchstart', (e) => {\n    e.preventDefault();\n    for (const touch of Array.from(e.changedTouches)) {\n      activeTouches.set(touch.identifier, { identifier: touch.identifier, element: 'dpad' });\n      updateDpadFromTouch(touch);\n    }\n  }, { passive: false });\n\n  // è§¸æ§ç§»å‹• (æ”¯æ´æ»‘å‹•æ”¹è®Šæ–¹å‘)\n  dpadArea.addEventListener('touchmove', (e) => {\n    e.preventDefault();\n    for (const touch of Array.from(e.changedTouches)) {\n      if (activeTouches.get(touch.identifier)?.element === 'dpad') {\n        updateDpadFromTouch(touch);\n      }\n    }\n  }, { passive: false });\n\n  // è§¸æ§çµæŸ\n  dpadArea.addEventListener('touchend', (e) => {\n    e.preventDefault();\n    for (const touch of Array.from(e.changedTouches)) {\n      if (activeTouches.get(touch.identifier)?.element === 'dpad') {\n        activeTouches.delete(touch.identifier);\n        // æª¢æŸ¥æ˜¯å¦é‚„æœ‰å…¶ä»– D-Pad è§¸æ§\n        const remainingDpadTouches = Array.from(activeTouches.values()).filter(t => t.element === 'dpad');\n        if (remainingDpadTouches.length === 0) {\n          clearDpad();\n        }\n      }\n    }\n  }, { passive: false });\n\n  dpadArea.addEventListener('touchcancel', (e) => {\n    e.preventDefault();\n    for (const touch of Array.from(e.changedTouches)) {\n      activeTouches.delete(touch.identifier);\n    }\n    clearDpad();\n  }, { passive: false });\n\n  // æ»‘é¼ äº‹ä»¶ (ç”¨æ–¼é›»è…¦æ¸¬è©¦)\n  let mouseDown = false;\n  dpadArea.addEventListener('mousedown', (e) => {\n    e.preventDefault();\n    mouseDown = true;\n    const rect = dpad.getBoundingClientRect();\n    const centerX = rect.left + rect.width / 2;\n    const centerY = rect.top + rect.height / 2;\n    const dx = e.clientX - centerX;\n    const dy = e.clientY - centerY;\n    const distance = Math.sqrt(dx * dx + dy * dy);\n    const maxRadius = rect.width / 2;\n    const deadZone = maxRadius * 0.15;\n    \n    const newState: DpadState = { up: false, down: false, left: false, right: false };\n    \n    if (distance > deadZone) {\n      const angle = Math.atan2(dy, dx) * 180 / Math.PI;\n      if (angle >= -22.5 && angle < 22.5) newState.right = true;\n      else if (angle >= 22.5 && angle < 67.5) { newState.right = true; newState.down = true; }\n      else if (angle >= 67.5 && angle < 112.5) newState.down = true;\n      else if (angle >= 112.5 && angle < 157.5) { newState.left = true; newState.down = true; }\n      else if (angle >= 157.5 || angle < -157.5) newState.left = true;\n      else if (angle >= -157.5 && angle < -112.5) { newState.left = true; newState.up = true; }\n      else if (angle >= -112.5 && angle < -67.5) newState.up = true;\n      else if (angle >= -67.5 && angle < -22.5) { newState.right = true; newState.up = true; }\n    }\n    applyDpadState(newState);\n  });\n\n  document.addEventListener('mousemove', (e) => {\n    if (!mouseDown) return;\n    const rect = dpad.getBoundingClientRect();\n    const centerX = rect.left + rect.width / 2;\n    const centerY = rect.top + rect.height / 2;\n    const dx = e.clientX - centerX;\n    const dy = e.clientY - centerY;\n    const distance = Math.sqrt(dx * dx + dy * dy);\n    const maxRadius = rect.width / 2;\n    const deadZone = maxRadius * 0.15;\n    \n    const newState: DpadState = { up: false, down: false, left: false, right: false };\n    \n    if (distance > deadZone && distance < maxRadius * 1.5) {\n      const angle = Math.atan2(dy, dx) * 180 / Math.PI;\n      if (angle >= -22.5 && angle < 22.5) newState.right = true;\n      else if (angle >= 22.5 && angle < 67.5) { newState.right = true; newState.down = true; }\n      else if (angle >= 67.5 && angle < 112.5) newState.down = true;\n      else if (angle >= 112.5 && angle < 157.5) { newState.left = true; newState.down = true; }\n      else if (angle >= 157.5 || angle < -157.5) newState.left = true;\n      else if (angle >= -157.5 && angle < -112.5) { newState.left = true; newState.up = true; }\n      else if (angle >= -112.5 && angle < -67.5) newState.up = true;\n      else if (angle >= -67.5 && angle < -22.5) { newState.right = true; newState.up = true; }\n    }\n    applyDpadState(newState);\n  });\n\n  document.addEventListener('mouseup', () => {\n    if (mouseDown) {\n      mouseDown = false;\n      clearDpad();\n    }\n  });\n}\n\n/**\n * å¥—ç”¨ D-Pad ç‹€æ…‹ä¸¦æ›´æ–°è¦–è¦º\n */\nfunction applyDpadState(newState: DpadState): void {\n  // æ›´æ–°æ§åˆ¶å™¨ï¼ˆé€é WASM ä»‹é¢ï¼‰\n  if (newState.up !== currentDpadState.up) {\n    nes?.setButton(0, ControllerButton.Up, newState.up);\n  }\n  if (newState.down !== currentDpadState.down) {\n    nes?.setButton(0, ControllerButton.Down, newState.down);\n  }\n  if (newState.left !== currentDpadState.left) {\n    nes?.setButton(0, ControllerButton.Left, newState.left);\n  }\n  if (newState.right !== currentDpadState.right) {\n    nes?.setButton(0, ControllerButton.Right, newState.right);\n  }\n  \n  // æ›´æ–°è¦–è¦º\n  document.getElementById('dpad-up')?.classList.toggle('pressed', newState.up);\n  document.getElementById('dpad-down')?.classList.toggle('pressed', newState.down);\n  document.getElementById('dpad-left')?.classList.toggle('pressed', newState.left);\n  document.getElementById('dpad-right')?.classList.toggle('pressed', newState.right);\n  \n  currentDpadState = { ...newState };\n}\n\n/**\n * è¨­å®š A/B æŒ‰éˆ• (æ”¯æ´å¤šé»è§¸æ§åŒæ™‚æŒ‰)\n */\nfunction setupABButtons(): void {\n  const btnA = document.getElementById('btn-a');\n  const btnB = document.getElementById('btn-b');\n  \n  const setupButton = (btn: HTMLElement | null, buttonType: ControllerButton, elementId: string) => {\n    if (!btn) return;\n    \n    btn.addEventListener('touchstart', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      for (const touch of Array.from(e.changedTouches)) {\n        activeTouches.set(touch.identifier, { identifier: touch.identifier, element: elementId });\n      }\n      nes?.setButton(0, buttonType, true);\n      btn.classList.add('pressed');\n    }, { passive: false });\n\n    btn.addEventListener('touchend', (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      for (const touch of Array.from(e.changedTouches)) {\n        activeTouches.delete(touch.identifier);\n      }\n      nes?.setButton(0, buttonType, false);\n      btn.classList.remove('pressed');\n    }, { passive: false });\n\n    btn.addEventListener('touchcancel', (e) => {\n      e.preventDefault();\n      for (const touch of Array.from(e.changedTouches)) {\n        activeTouches.delete(touch.identifier);\n      }\n      nes?.setButton(0, buttonType, false);\n      btn.classList.remove('pressed');\n    }, { passive: false });\n\n    // æ»‘é¼ äº‹ä»¶\n    btn.addEventListener('mousedown', (e) => {\n      e.preventDefault();\n      nes?.setButton(0, buttonType, true);\n      btn.classList.add('pressed');\n    });\n\n    btn.addEventListener('mouseup', (e) => {\n      e.preventDefault();\n      nes?.setButton(0, buttonType, false);\n      btn.classList.remove('pressed');\n    });\n\n    btn.addEventListener('mouseleave', () => {\n      nes?.setButton(0, buttonType, false);\n      btn.classList.remove('pressed');\n    });\n  };\n\n  setupButton(btnA, ControllerButton.A, 'a');\n  setupButton(btnB, ControllerButton.B, 'b');\n}\n\n/**\n * è¨­å®šåŠŸèƒ½æŒ‰éˆ• (Select/Start)\n */\nfunction setupFunctionButtons(): void {\n  const buttons = document.querySelectorAll('[data-btn=\"select\"], [data-btn=\"start\"]');\n  \n  buttons.forEach(btn => {\n    const button = btn as HTMLElement;\n    const btnType = button.dataset.btn;\n    const buttonEnum = btnType === 'start' ? ControllerButton.Start : ControllerButton.Select;\n\n    button.addEventListener('touchstart', (e) => {\n      e.preventDefault();\n      nes?.setButton(0, buttonEnum, true);\n      button.classList.add('pressed');\n    }, { passive: false });\n\n    button.addEventListener('touchend', (e) => {\n      e.preventDefault();\n      nes?.setButton(0, buttonEnum, false);\n      button.classList.remove('pressed');\n    }, { passive: false });\n\n    button.addEventListener('touchcancel', (e) => {\n      e.preventDefault();\n      nes?.setButton(0, buttonEnum, false);\n      button.classList.remove('pressed');\n    }, { passive: false });\n\n    button.addEventListener('mousedown', (e) => {\n      e.preventDefault();\n      nes?.setButton(0, buttonEnum, true);\n      button.classList.add('pressed');\n    });\n\n    button.addEventListener('mouseup', (e) => {\n      e.preventDefault();\n      nes?.setButton(0, buttonEnum, false);\n      button.classList.remove('pressed');\n    });\n\n    button.addEventListener('mouseleave', () => {\n      nes?.setButton(0, buttonEnum, false);\n      button.classList.remove('pressed');\n    });\n  });\n}\n\n/**\n * è™•ç†æŒ‰éˆ•æŒ‰ä¸‹/é‡‹æ”¾ (ä¿ç•™çµ¦å…¶ä»–ç”¨é€”)\n */\nfunction handleButtonPress(btnType: string, pressed: boolean): void {\n  const buttonMap: Record<string, ControllerButton> = {\n    'up': ControllerButton.Up,\n    'down': ControllerButton.Down,\n    'left': ControllerButton.Left,\n    'right': ControllerButton.Right,\n    'a': ControllerButton.A,\n    'b': ControllerButton.B,\n    'start': ControllerButton.Start,\n    'select': ControllerButton.Select,\n  };\n  \n  const button = buttonMap[btnType];\n  if (button !== undefined) {\n    nes?.setButton(0, button, pressed);\n  }\n}\n\n// ===== é›»è…¦ç‰ˆæ§åˆ¶ =====\n\n/**\n * è¨­å®šé›»è…¦ç‰ˆæ§åˆ¶æŒ‰éˆ•\n */\nfunction setupDesktopControls(): void {\n  document.getElementById('btn-pause')?.addEventListener('click', stopEmulation);\n  document.getElementById('btn-resume')?.addEventListener('click', startEmulation);\n  document.getElementById('btn-reset')?.addEventListener('click', () => nes?.reset());\n  document.getElementById('btn-select-game')?.addEventListener('click', showRomSelector);\n  \n  // å­˜æª”/è®€å–æŒ‰éˆ• (é›»è…¦ç‰ˆ)\n  document.getElementById('btn-save-state')?.addEventListener('click', () => {\n    if (saveState(0)) {\n      showToast('âœ… å­˜æª”æˆåŠŸ');\n    } else {\n      showToast('âŒ å­˜æª”å¤±æ•—');\n    }\n  });\n  document.getElementById('btn-load-state')?.addEventListener('click', () => {\n    if (loadState(0)) {\n      showToast('âœ… è®€å–æˆåŠŸ');\n    } else {\n      showToast('âŒ æ²’æœ‰å­˜æª”');\n    }\n  });\n  \n  // å­˜æª”/è®€å–æŒ‰éˆ• (æ‰‹æ©Ÿç‰ˆ)\n  document.getElementById('mobile-save-state')?.addEventListener('click', () => {\n    if (saveState(0)) {\n      showToast('âœ… å­˜æª”æˆåŠŸ');\n    } else {\n      showToast('âŒ å­˜æª”å¤±æ•—');\n    }\n  });\n  document.getElementById('mobile-load-state')?.addEventListener('click', () => {\n    if (loadState(0)) {\n      showToast('âœ… è®€å–æˆåŠŸ');\n    } else {\n      showToast('âŒ æ²’æœ‰å­˜æª”');\n    }\n  });\n}\n\n/**\n * è¨­å®šæª”æ¡ˆé¸æ“‡å™¨ (é›»è…¦ç‰ˆ)\n */\nfunction setupFileInput(): void {\n  const fileInput = document.getElementById('rom-input') as HTMLInputElement;\n  \n  fileInput?.addEventListener('change', async (event) => {\n    const input = event.target as HTMLInputElement;\n    const file = input.files?.[0];\n    \n    if (file) {\n      await loadRomFromFile(file);\n    }\n  });\n}\n\n// ===== æ¨¡æ“¬å™¨æ§åˆ¶ =====\n\n/**\n * é–‹å§‹æ¨¡æ“¬\n */\nfunction startEmulation(): void {\n  if (animationId !== null) {\n    cancelAnimationFrame(animationId);\n  }\n\n  isRunning = true;\n\n  // NES NTSC å¹€ç‡ï¼š60.0988 fps\n  const TARGET_FRAME_TIME = 1000 / 60.0988;\n  let lastFrameTime = performance.now();\n  let accumulator = 0;\n\n  const frameLoop = (currentTime: number): void => {\n    if (!nes || !ctx || !imageData || !isRunning) return;\n\n    const deltaTime = currentTime - lastFrameTime;\n    lastFrameTime = currentTime;\n    \n    accumulator += deltaTime;\n    \n    if (accumulator > TARGET_FRAME_TIME * 3) {\n      accumulator = TARGET_FRAME_TIME;\n    }\n\n    while (accumulator >= TARGET_FRAME_TIME) {\n      nes.frame();\n      accumulator -= TARGET_FRAME_TIME;\n    }\n\n    renderFrame();\n    animationId = requestAnimationFrame(frameLoop);\n  };\n\n  animationId = requestAnimationFrame(frameLoop);\n}\n\n/**\n * åœæ­¢æ¨¡æ“¬\n */\nfunction stopEmulation(): void {\n  isRunning = false;\n  if (animationId !== null) {\n    cancelAnimationFrame(animationId);\n    animationId = null;\n  }\n}\n\n/**\n * æ¸²æŸ“ä¸€å¹€åˆ°ç•«å¸ƒ\n */\nfunction renderFrame(): void {\n  if (!nes || !ctx || !imageData) return;\n\n  // é‡è¦ï¼šæ¯æ¬¡éƒ½é‡æ–°å–å¾— WASM memory åƒè€ƒ\n  // å› ç‚º WASM è¨˜æ†¶é«”å¢é•·å¾Œ buffer æœƒè®Šç‚º detached\n  const memory = nes.getWasmMemory() as WebAssembly.Memory;\n\n  // å¾ WASM è¨˜æ†¶é«”è®€å– RGBA ç•«é¢è³‡æ–™\n  const ptr = nes.getFrameBufferPtr();\n  const len = nes.getFrameBufferLen();\n  const frameBuffer = new Uint8Array(memory.buffer, ptr, len);\n  \n  imageData.data.set(frameBuffer);\n  ctx.putImageData(imageData, 0, 0);\n}\n\n// ===== éŸ³é »ç³»çµ± =====\n\n/**\n * åˆå§‹åŒ–éŸ³é »ç³»çµ±\n */\nasync function initAudio(): Promise<void> {\n  try {\n    audioContext = new AudioContext({ sampleRate: 44100 });\n    \n    if (nes) {\n      nes.setAudioSampleRate(audioContext.sampleRate);\n    }\n    \n    const scriptProcessor = audioContext.createScriptProcessor(AUDIO_BUFFER_SIZE, 0, 1);\n    \n    scriptProcessor.onaudioprocess = (e) => {\n      const output = e.outputBuffer.getChannelData(0);\n      if (nes && isRunning) {\n        const available = nes.getAudioBufferLen();\n        if (available > 0) {\n          // é‡è¦ï¼šæ¯æ¬¡éƒ½é‡æ–°å–å¾— WASM memory åƒè€ƒ\n          const memory = nes.getWasmMemory() as WebAssembly.Memory;\n          const ptr = nes.getAudioBufferPtr();\n          const samples = new Float32Array(memory.buffer, ptr, available);\n          const count = Math.min(available, output.length);\n          for (let i = 0; i < count; i++) {\n            output[i] = samples[i];\n          }\n          lastAudioSample = samples[count - 1];\n          // å–æ¨£ä¸è¶³æ™‚ç”¨æœ€å¾Œä¸€å€‹æœ‰æ•ˆå€¼æ¼¸è®Šå¡«å……\n          for (let i = count; i < output.length; i++) {\n            lastAudioSample *= 0.999;\n            output[i] = lastAudioSample;\n          }\n          nes.consumeAudioSamples();\n        } else {\n          // ç„¡è³‡æ–™ï¼šç”¨ä¸Šæ¬¡æœ€å¾Œå–æ¨£å€¼æ¼¸è®Šåˆ°éœéŸ³\n          for (let i = 0; i < output.length; i++) {\n            lastAudioSample *= 0.999;\n            output[i] = lastAudioSample;\n          }\n        }\n      } else {\n        output.fill(0);\n      }\n    };\n    \n    scriptProcessor.connect(audioContext.destination);\n    console.log('éŸ³é »ç³»çµ±å·²åˆå§‹åŒ–ï¼Œå–æ¨£ç‡:', audioContext.sampleRate);\n  } catch (e) {\n    console.error('éŸ³é »åˆå§‹åŒ–å¤±æ•—:', e);\n  }\n}\n\n/**\n * æ¢å¾©éŸ³é »\n */\nfunction resumeAudio(): void {\n  if (audioContext && audioContext.state === 'suspended') {\n    audioContext.resume();\n  }\n}\n\n// ===== å­˜æª”ç³»çµ± =====\n\nconst SAVE_STATE_PREFIX = 'nes_savestate_';\n\n/**\n * é¡¯ç¤ºæç¤ºè¨Šæ¯\n */\nfunction showToast(message: string): void {\n  // ç§»é™¤èˆŠçš„ toast\n  const existingToast = document.querySelector('.toast-message');\n  if (existingToast) {\n    existingToast.remove();\n  }\n  \n  // å»ºç«‹æ–°çš„ toast\n  const toast = document.createElement('div');\n  toast.className = 'toast-message';\n  toast.textContent = message;\n  toast.style.cssText = `\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background: rgba(0, 0, 0, 0.8);\n    color: white;\n    padding: 15px 30px;\n    border-radius: 10px;\n    font-size: 16px;\n    font-weight: bold;\n    z-index: 10000;\n    animation: toastFade 1.5s ease-out forwards;\n  `;\n  \n  // æ·»åŠ å‹•ç•«æ¨£å¼\n  if (!document.querySelector('#toast-style')) {\n    const style = document.createElement('style');\n    style.id = 'toast-style';\n    style.textContent = `\n      @keyframes toastFade {\n        0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }\n        70% { opacity: 1; transform: translate(-50%, -50%) scale(1); }\n        100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }\n      }\n    `;\n    document.head.appendChild(style);\n  }\n  \n  document.body.appendChild(toast);\n  \n  // è‡ªå‹•ç§»é™¤\n  setTimeout(() => toast.remove(), 1500);\n}\n\nfunction saveState(slot: number = 0): boolean {\n  if (!nes) return false;\n  \n  try {\n    const saveData = nes.exportSaveState();\n    const key = `${SAVE_STATE_PREFIX}${slot}`;\n    localStorage.setItem(key, saveData);\n    console.log(`å­˜æª”æˆåŠŸ (Slot ${slot})`);\n    return true;\n  } catch (e) {\n    console.error('å­˜æª”å¤±æ•—:', e);\n    return false;\n  }\n}\n\nfunction loadState(slot: number = 0): boolean {\n  if (!nes) return false;\n  \n  try {\n    const key = `${SAVE_STATE_PREFIX}${slot}`;\n    const saveData = localStorage.getItem(key);\n    \n    if (!saveData) {\n      console.log(`Slot ${slot} æ²’æœ‰å­˜æª”`);\n      return false;\n    }\n    \n    const success = nes.importSaveState(saveData);\n    if (success) {\n      console.log(`è®€å–å­˜æª”æˆåŠŸ (Slot ${slot})`);\n    }\n    return success;\n  } catch (e) {\n    console.error('è®€å–å­˜æª”å¤±æ•—:', e);\n    return false;\n  }\n}\n\nfunction exportSaveToFile(): void {\n  if (!nes) return;\n  \n  const saveData = nes.exportSaveState();\n  const blob = new Blob([saveData], { type: 'text/plain' });\n  const url = URL.createObjectURL(blob);\n  \n  const a = document.createElement('a');\n  a.href = url;\n  a.download = `nes_savestate_${Date.now()}.txt`;\n  a.click();\n  \n  URL.revokeObjectURL(url);\n}\n\n// ===== éµç›¤å¿«æ·éµ =====\n\nfunction setupKeyboardShortcuts(): void {\n  document.addEventListener('keydown', (e) => {\n    if (e.key === 'F5') {\n      e.preventDefault();\n      saveState(0);\n    }\n    if (e.key === 'F7') {\n      e.preventDefault();\n      loadState(0);\n    }\n    if (e.key >= 'F1' && e.key <= 'F4' && e.shiftKey) {\n      e.preventDefault();\n      const slot = parseInt(e.key[1]);\n      saveState(slot);\n    }\n    if (e.key >= '1' && e.key <= '4' && e.ctrlKey) {\n      e.preventDefault();\n      const slot = parseInt(e.key);\n      loadState(slot);\n    }\n    // ESC éµè¿”å›é¸æ“‡ç•«é¢\n    if (e.key === 'Escape') {\n      showRomSelector();\n    }\n  });\n}\n\n// ===== å…¨åŸŸåŒ¯å‡º =====\n\ndeclare global {\n  interface Window {\n    nes: NesWasm | null;\n    startEmulation: () => void;\n    stopEmulation: () => void;\n    saveState: (slot?: number) => boolean;\n    loadState: (slot?: number) => boolean;\n    exportSaveToFile: () => void;\n    showRomSelector: () => void;\n  }\n}\n\nwindow.nes = null;\nwindow.startEmulation = startEmulation;\nwindow.stopEmulation = stopEmulation;\nwindow.saveState = saveState;\nwindow.loadState = loadState;\nwindow.exportSaveToFile = exportSaveToFile;\nwindow.showRomSelector = showRomSelector;\n\n// ===== å•Ÿå‹• =====\n\ndocument.addEventListener('DOMContentLoaded', async () => {\n  await initWasm();\n  await initAudio();\n  setupKeyboardShortcuts();\n  window.nes = nes;\n  \n  // ç”¨æˆ¶äº¤äº’å¾Œæ¢å¾©éŸ³é »\n  document.addEventListener('click', resumeAudio, { once: true });\n  document.addEventListener('keydown', resumeAudio, { once: true });\n  document.addEventListener('touchstart', resumeAudio, { once: true });\n});\n"],"names":["NesWasm","ptr","NesWasmFinalization","wasm","deferred1_0","deferred1_1","retptr","r0","getDataViewMemory0","r1","getStringFromWasm0","ret","takeObject","json","ptr0","passStringToWasm0","len0","WASM_VECTOR_LEN","rom_data","passArray8ToWasm0","rate","controller","button","pressed","__wbg_get_imports","addHeapObject","arg0","arg1","obj","heap_next","heap","idx","dropObject","cachedDataViewMemory0","len","decodeText","cachedUint8ArrayMemory0","getUint8ArrayMemory0","getObject","arg","malloc","realloc","buf","cachedTextEncoder","mem","offset","code","view","cachedTextDecoder","MAX_SAFARI_DECODE_BYTES","numBytesDecoded","__wbg_finalize_init","instance","module","__wbg_load","imports","e","expectedResponseType","bytes","type","__wbg_init","module_or_path","ControllerButton","nes","animationId","canvas","ctx","imageData","audioContext","isRunning","romSelector","gameboyShell","powerLed","AUDIO_BUFFER_SIZE","lastAudioSample","initWasm","init","setupKeyboardInput","setupVirtualController","setupDesktopControls","setupRomSelector","setupFileInput","KEYBOARD_MAP_P1","loadRomList","file","loadRomFromFile","romListEl","response","data","renderRomList","error","roms","rom","index","item","loadRomFromServer","filename","buffer","startGame","romData","romBytes","hideRomSelector","resumeAudio","startEmulation","showRomSelector","stopEmulation","activeTouches","currentDpadState","setupDpad","setupABButtons","setupFunctionButtons","dpadArea","dpad","updateDpadFromTouch","touch","rect","centerX","centerY","dx","dy","distance","deadZone","newState","angle","applyDpadState","clearDpad","t","mouseDown","maxRadius","btnA","btnB","setupButton","btn","buttonType","elementId","buttonEnum","saveState","showToast","loadState","event","TARGET_FRAME_TIME","lastFrameTime","accumulator","frameLoop","currentTime","deltaTime","renderFrame","memory","frameBuffer","initAudio","scriptProcessor","output","available","samples","count","i","SAVE_STATE_PREFIX","message","existingToast","toast","style","slot","saveData","key","success","exportSaveToFile","blob","url","a","setupKeyboardShortcuts"],"mappings":"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"}